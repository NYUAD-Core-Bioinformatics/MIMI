<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Workflow &mdash; Mass Spectrometry Tool 1.0.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Architecture Design" href="architecture.html" />
    <link rel="prev" title="Overview" href="overview.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Mass Spectrometry Tool
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Workflow</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#basic-workflow">Basic Workflow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#database-preparation">1. Database Preparation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cache-creation">2. Cache Creation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sample-analysis">3. Sample Analysis</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#step1-database-preparation">Step1: Database Preparation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#database-sources">Database Sources</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mass-range-filtering">Mass Range Filtering</a></li>
<li class="toctree-l3"><a class="reference internal" href="#database-preparation-example">Database Preparation Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#step2-cache-creation">Step2: Cache Creation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#isotope-configuration">Isotope Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#verify-cache">Verify Cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step3-sample-analysis">Step3: Sample Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="#input-file-format">Input File Format</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ppm-thresholds">PPM Thresholds</a></li>
<li class="toctree-l2"><a class="reference internal" href="#multiple-cache-analysis">Multiple Cache Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="#batch-processing">Batch Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#results-format">Results Format</a></li>
<li class="toctree-l2"><a class="reference internal" href="#comprehensive-analysis-runs">Comprehensive Analysis Runs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="#complete-example">Complete Example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_reference.html">Command Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="mimi_package.html">mimi package</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Mass Spectrometry Tool</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Workflow</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/workflow.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="workflow">
<h1>Workflow<a class="headerlink" href="#workflow" title="Permalink to this headline"></a></h1>
<p>MIMI is a tool for analyzing mass spectrometry data. It helps identify compounds by matching observed masses against known compounds and verifying their isotope patterns.</p>
<section id="installation">
<span id="id1"></span><h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline"></a></h2>
<p>MIMI can be installed using conda, which is the recommended method as it handles all dependencies automatically:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">c</span> <span class="n">conda</span><span class="o">-</span><span class="n">forge</span> <span class="n">mimi</span>
</pre></div>
</div>
<p>Alternatively, you can install from source if you need the latest development version:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">NYUAD</span><span class="o">-</span><span class="n">Core</span><span class="o">-</span><span class="n">Bioinformatics</span><span class="o">/</span><span class="n">MIMI</span><span class="o">.</span><span class="n">git</span>
<span class="n">cd</span> <span class="n">MIMI</span>
<span class="n">pip</span> <span class="n">install</span> <span class="o">.</span>
</pre></div>
</div>
</section>
<section id="basic-workflow">
<h2>Basic Workflow<a class="headerlink" href="#basic-workflow" title="Permalink to this headline"></a></h2>
<p>MIMI’s analysis involves three steps:</p>
<section id="database-preparation">
<h3>1. Database Preparation<a class="headerlink" href="#database-preparation" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>Choose and prepare a compound database from KEGG, HMDB, or create a custom one</p></li>
<li><p>Filter compounds by mass range using -l (lower limit) and -u (upper limit) parameters</p></li>
<li><p>The output is a TSV file containing compounds with their chemical formulas(CF), Compound IDs(ID), and names(Name)</p></li>
<li><p>You can also create a custom database with specific compounds of interest</p></li>
</ul>
<p>See for more details: <a class="reference internal" href="#id2"><span class="std std-ref">Step1: Database Preparation</span></a>, <a class="reference internal" href="#database-sources"><span class="std std-ref">Database Sources</span></a>, <a class="reference internal" href="#mass-range-filtering"><span class="std std-ref">Mass Range Filtering</span></a>, <a class="reference internal" href="#database-preparation-example"><span class="std std-ref">Database Preparation Example</span></a></p>
</section>
<section id="cache-creation">
<h3>2. Cache Creation<a class="headerlink" href="#cache-creation" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>This step precomputes molecular masses and isotope patterns for all compounds in your database</p></li>
<li><p>You can create caches for different isotope configurations (natural abundance or labeled)</p></li>
<li><p>The cache creation is essential for fast analysis performance</p></li>
<li><p>You can specify tolerance levels for both mass matching (-p) and isotope pattern verification (-vp)</p></li>
<li><p>You can verify the cache contents using <cite>mimi_cache_dump</cite> to ensure everything was processed correctly</p></li>
</ul>
<p>See for more details: <a class="reference internal" href="#step2-cache-creation"><span class="std std-ref">Step2: Cache Creation</span></a>, <a class="reference internal" href="#ppm-thresholds"><span class="std std-ref">PPM Thresholds</span></a>, <a class="reference internal" href="#isotope-configuration"><span class="std std-ref">Isotope Configuration</span></a>, <a class="reference internal" href="#verify-cache"><span class="std std-ref">Verify Cache</span></a></p>
</section>
<section id="sample-analysis">
<h3>3. Sample Analysis<a class="headerlink" href="#sample-analysis" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>This step matches your mass spectrometry data against the precomputed database</p></li>
<li><p>You can analyze samples in <cite>.asc</cite> format, which should contain mass, intensity, and resolution columns</p></li>
<li><p>The analysis process includes both mass matching and isotope pattern verification</p></li>
<li><p>Multiple cache files can be specified for comparative or labeled analyses</p></li>
<li><p>The output is a TSV file containing detailed information about all matched compounds</p></li>
<li><p>For convenience, a provided script allows you to run comprehensive analysis across multiple cache files and sample files, testing different PPM thresholds automatically</p></li>
</ul>
<p>See for more details: <a class="reference internal" href="#step3-sample-analysis"><span class="std std-ref">Step3: Sample Analysis</span></a>, <a class="reference internal" href="#input-file-format"><span class="std std-ref">Input File Format</span></a>, <a class="reference internal" href="#multiple-cache-analysis"><span class="std std-ref">Multiple Cache Analysis</span></a>, <a class="reference internal" href="#batch-processing"><span class="std std-ref">Batch Processing</span></a>, <a class="reference internal" href="#results-format"><span class="std std-ref">Results Format</span></a>, <a class="reference internal" href="#comprehensive-analysis-runs"><span class="std std-ref">Comprehensive Analysis Runs</span></a></p>
</section>
</section>
<section id="step1-database-preparation">
<span id="id2"></span><h2>Step1: Database Preparation<a class="headerlink" href="#step1-database-preparation" title="Permalink to this headline"></a></h2>
<p>MIMI provides flexible options for preparing your compound database. You can either use established databases (KEGG or HMDB) or create a custom database. The choice depends on your research needs:</p>
<section id="database-sources">
<span id="id3"></span><h3>Database Sources<a class="headerlink" href="#database-sources" title="Permalink to this headline"></a></h3>
<ol class="arabic">
<li><p><strong>KEGG Database</strong></p>
<p>Best for general biological samples:</p>
<ul class="simple">
<li><p>Comprehensive compound coverage</p></li>
<li><p>Integrated pathway information</p></li>
<li><p>Access via <a class="reference external" href="https://www.kegg.jp/kegg/rest/keggapi.html">REST API</a></p></li>
<li><p>Suitable for broad metabolomics studies</p></li>
</ul>
</li>
<li><p><strong>HMDB Database</strong></p>
<p>Optimal for human studies:</p>
<ul class="simple">
<li><p>Human-specific metabolites</p></li>
<li><p>Detailed metabolite annotations</p></li>
<li><p>Requires <a class="reference external" href="https://hmdb.ca/downloads">HMDB</a> XML file</p></li>
<li><p>Best for clinical and biomedical research</p></li>
</ul>
</li>
<li><p><strong>Custom Database</strong></p>
<p>Create your own when:</p>
<ul class="simple">
<li><p>Working with novel compounds</p></li>
<li><p>Focusing on specific compounds of interest</p></li>
<li><p>Needing custom annotations</p></li>
<li><p>Combining multiple data sources</p></li>
</ul>
<p>Required format (TSV file):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CF</span>      <span class="n">ID</span>        <span class="n">Name</span>
<span class="n">C6H12O6</span> <span class="n">C00031</span>    <span class="n">Glucose</span>
<span class="n">C5H10O5</span> <span class="n">C00036</span>    <span class="n">Ribose</span>
<span class="n">C3H7NO2</span> <span class="n">C00041</span>    <span class="n">Alanine</span>
<span class="n">C7H6O2</span>  <span class="n">C00042</span>    <span class="n">Benzoic</span> <span class="n">Acid</span>
<span class="n">C4H8O4</span>  <span class="n">C00043</span>    <span class="n">Erythritol</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="mass-range-filtering">
<span id="id4"></span><h3>Mass Range Filtering<a class="headerlink" href="#mass-range-filtering" title="Permalink to this headline"></a></h3>
<p>All database preparation methods support mass filtering to focus on your range of interest:</p>
<ul class="simple">
<li><p><cite>-l</cite>: Lower mass limit</p>
<ul>
<li><p>Excludes compounds below specified mass</p></li>
<li><p>Example: <cite>-l 40</cite> removes compounds &lt; 40 Da</p></li>
<li><p>Useful for filtering out small molecules/contaminants</p></li>
</ul>
</li>
<li><p><cite>-u</cite>: Upper mass limit</p>
<ul>
<li><p>Excludes compounds above specified mass</p></li>
<li><p>Example: <cite>-u 1000</cite> removes compounds &gt; 1000 Da</p></li>
<li><p>Helps focus on relevant mass ranges</p></li>
</ul>
</li>
</ul>
<p>Example: <cite>-l 40 -u 1000</cite> retains only compounds between 40-1000 Da.</p>
</section>
<section id="database-preparation-example">
<span id="id5"></span><h3>Database Preparation Example<a class="headerlink" href="#database-preparation-example" title="Permalink to this headline"></a></h3>
<p>Here’s how to prepare databases from different sources using a typical mass range of 40-1000 Da (based on common MS data ranges):</p>
<ol class="arabic">
<li><p><strong>From KEGG</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract compounds</span>
<span class="n">mimi_kegg_extract</span> <span class="o">-</span><span class="n">l</span> <span class="mi">40</span> <span class="o">-</span><span class="n">u</span> <span class="mi">1000</span> <span class="o">-</span><span class="n">o</span> <span class="n">data</span><span class="o">/</span><span class="n">processed</span><span class="o">/</span><span class="n">kegg_compounds_40_1000Da</span><span class="o">.</span><span class="n">tsv</span>

<span class="c1"># Sort and remove duplicates</span>
<span class="p">{</span> <span class="n">head</span> <span class="o">-</span><span class="n">n</span> <span class="mi">1</span> <span class="n">data</span><span class="o">/</span><span class="n">processed</span><span class="o">/</span><span class="n">kegg_compounds_40_1000Da</span><span class="o">.</span><span class="n">tsv</span><span class="p">;</span> <span class="n">tail</span> <span class="o">-</span><span class="n">n</span> <span class="o">+</span><span class="mi">2</span> <span class="n">data</span><span class="o">/</span><span class="n">processed</span><span class="o">/</span><span class="n">kegg_compounds_40_1000Da</span><span class="o">.</span><span class="n">tsv</span> <span class="o">|</span> <span class="n">sort</span> <span class="o">-</span><span class="n">k2</span><span class="p">,</span><span class="mi">2</span><span class="p">;</span> <span class="p">}</span> <span class="o">&gt;</span> <span class="n">data</span><span class="o">/</span><span class="n">processed</span><span class="o">/</span><span class="n">kegg_compounds_40_1000Da_sorted</span><span class="o">.</span><span class="n">tsv</span>
<span class="n">awk</span> <span class="s1">&#39;!seen[$1]++&#39;</span> <span class="n">data</span><span class="o">/</span><span class="n">processed</span><span class="o">/</span><span class="n">kegg_compounds_40_1000Da_sorted</span><span class="o">.</span><span class="n">tsv</span> <span class="o">&gt;</span> <span class="n">data</span><span class="o">/</span><span class="n">processed</span><span class="o">/</span><span class="n">kegg_compounds_40_1000Da_sorted_uniq</span><span class="o">.</span><span class="n">tsv</span>
</pre></div>
</div>
</li>
<li><p><strong>From HMDB</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># First download the HMDB XML file, then extract compounds</span>
<span class="n">mimi_hmdb_extract</span> <span class="o">-</span><span class="n">l</span> <span class="mi">40</span> <span class="o">-</span><span class="n">u</span> <span class="mi">1000</span> <span class="o">-</span><span class="n">x</span> <span class="n">data</span><span class="o">/</span><span class="n">processed</span><span class="o">/</span><span class="n">hmdb_metabolites</span><span class="o">.</span><span class="n">xml</span> <span class="o">-</span><span class="n">o</span> <span class="n">data</span><span class="o">/</span><span class="n">processed</span><span class="o">/</span><span class="n">hmdb_compounds_40_1000Da</span><span class="o">.</span><span class="n">tsv</span>

<span class="c1"># Sort and remove duplicates</span>
<span class="p">{</span> <span class="n">head</span> <span class="o">-</span><span class="n">n</span> <span class="mi">1</span> <span class="n">data</span><span class="o">/</span><span class="n">processed</span><span class="o">/</span><span class="n">hmdb_compounds_40_1000Da</span><span class="o">.</span><span class="n">tsv</span><span class="p">;</span> <span class="n">tail</span> <span class="o">-</span><span class="n">n</span> <span class="o">+</span><span class="mi">2</span> <span class="n">data</span><span class="o">/</span><span class="n">processed</span><span class="o">/</span><span class="n">hmdb_compounds_40_1000Da</span><span class="o">.</span><span class="n">tsv</span> <span class="o">|</span> <span class="n">sort</span> <span class="o">-</span><span class="n">k2</span><span class="p">,</span><span class="mi">2</span><span class="p">;</span> <span class="p">}</span> <span class="o">&gt;</span> <span class="n">data</span><span class="o">/</span><span class="n">processed</span><span class="o">/</span><span class="n">hmdb_compounds_40_1000Da_sorted</span><span class="o">.</span><span class="n">tsv</span>
<span class="n">awk</span> <span class="s1">&#39;!seen[$1]++&#39;</span> <span class="n">data</span><span class="o">/</span><span class="n">processed</span><span class="o">/</span><span class="n">hmdb_compounds_40_1000Da_sorted</span><span class="o">.</span><span class="n">tsv</span> <span class="o">&gt;</span> <span class="n">data</span><span class="o">/</span><span class="n">processed</span><span class="o">/</span><span class="n">hmdb_compounds_40_1000Da_sorted_uniq</span><span class="o">.</span><span class="n">tsv</span>
</pre></div>
</div>
</li>
</ol>
<p>The output in both cases will be a TSV file containing:</p>
<ul class="simple">
<li><p>Chemical formulas (CF)</p></li>
<li><p>Compound IDs (ID)</p></li>
<li><p>Compound names (Name)</p></li>
<li><p>Only compounds within the specified mass range</p></li>
</ul>
<p>This mass range we used is suitable for typical MS data, as shown in this example data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ head data/processed/testdata1.asc
43.16184    1089317 0.00003
43.28766    1115802 0.00003
43.28946    1226947 0.00003
43.30269    1107425 0.00005
43.36457    2236071 0.00004
43.36459    1891040 0.00004
43.37268    1281049 0.00004
43.4223     2184166 0.00002
43.42234    23344476        0.00004
43.42237    22443004        0.00004

$ tail data/processed/testdata1.asc
998.43509   1206308 0.00535
998.46616   1131300 0.00695
998.73782   1093661 0.00813
999.04497   1088280 0.00781
999.2502    1257493 0.00659
999.26602   1114389 0.00842
999.50487   2941816 0.02121
999.52689   2547575 0.01782
999.90084   1347088 0.00892
999.99347   2578292 0.00277
</pre></div>
</div>
</section>
</section>
<section id="step2-cache-creation">
<span id="id6"></span><h2>Step2: Cache Creation<a class="headerlink" href="#step2-cache-creation" title="Permalink to this headline"></a></h2>
<p>Create cache files to store precomputed molecular masses and isotope patterns. This step is essential for:</p>
<ul class="simple">
<li><p>Fast analysis performance</p></li>
<li><p>Initial setup before any analysis</p></li>
<li><p>Updates when:</p>
<ul>
<li><p>Database changes</p></li>
<li><p>Isotope settings change</p></li>
<li><p>New project begins</p></li>
</ul>
</li>
</ul>
<p>For natural abundance compounds, use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mimi_cache_create</span> <span class="o">-</span><span class="n">i</span> <span class="n">neg</span> <span class="o">-</span><span class="n">d</span> <span class="n">data</span><span class="o">/</span><span class="n">processed</span><span class="o">/</span><span class="n">kegg_compounds_40_1000Da_sorted_uniq</span><span class="o">.</span><span class="n">tsv</span> <span class="o">-</span><span class="n">c</span> <span class="n">outdir</span><span class="o">/</span><span class="n">db_nat</span>
</pre></div>
</div>
<p>Expected Output: A binary cache file containing precomputed masses and isotope patterns for all compounds in your database. This file will be used for fast matching during analysis.</p>
</section>
<section id="isotope-configuration">
<span id="id7"></span><h2>Isotope Configuration<a class="headerlink" href="#isotope-configuration" title="Permalink to this headline"></a></h2>
<p>MIMI uses atomic weights and natural isotope abundances from the National Institute of Standards and Technology (NIST). The original data, sourced from the <a class="reference external" href="https://www.nist.gov/pml/atomic-weights-and-isotopic-compositions-relative-atomic-masses">NIST Atomic Weights database</a>, was converted from plain text to JSON format for easier processing and is distributed with MIMI as <a class="reference external" href="https://raw.githubusercontent.com/NYUAD-Core-Bioinformatics/MIMI/refs/heads/main/mimi/data/natural_isotope_abundance_NIST.json">natural_isotope_abundance_NIST.json</a>. This file serves as the foundation for all isotopic calculations.</p>
<p>For each element in <cite>natural_isotope_abundance_NIST.json</cite>, it provides detailed information about all its naturally occurring isotopes, including:</p>
<ol class="arabic simple">
<li><p><strong>Element Organization</strong>: Data is organized by element symbol (e.g., “H”, “C”, “O”, etc.)</p></li>
<li><p><strong>Isotope Information</strong>: For each isotope of an element, the file includes:</p>
<ul class="simple">
<li><p><cite>periodic_number</cite>: The atomic number of the element</p></li>
<li><p><cite>element_symbol</cite>: The chemical symbol of the element</p></li>
<li><p><cite>nominal_mass</cite>: The mass number (number of protons + neutrons)</p></li>
<li><p><cite>exact_mass</cite>: The precise atomic mass in atomic mass units (u)</p></li>
<li><p><cite>isotope_abundance</cite>: The relative abundance of the isotope in nature</p></li>
</ul>
</li>
</ol>
<p>Example entry for Carbon (C):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;periodic_number&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
        <span class="s2">&quot;element_symbol&quot;</span><span class="p">:</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span>
        <span class="s2">&quot;nominal_mass&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
        <span class="s2">&quot;exact_mass&quot;</span><span class="p">:</span> <span class="mf">12.0</span><span class="p">,</span>
        <span class="s2">&quot;isotope_abundance&quot;</span><span class="p">:</span> <span class="mf">0.9893</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;periodic_number&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
        <span class="s2">&quot;element_symbol&quot;</span><span class="p">:</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span>
        <span class="s2">&quot;nominal_mass&quot;</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span>
        <span class="s2">&quot;exact_mass&quot;</span><span class="p">:</span> <span class="mf">13.00335483507</span><span class="p">,</span>
        <span class="s2">&quot;isotope_abundance&quot;</span><span class="p">:</span> <span class="mf">0.0107</span>
    <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>This data is used for:</p>
<ul class="simple">
<li><p>Calculating exact molecular masses</p></li>
<li><p>Determining molecular isotope patterns</p></li>
<li><p>Computing Molecular abundances</p></li>
</ul>
<p>For samples with stable isotope enrichment, you can override these values using the <cite>–label</cite> (<cite>-l</cite>) option with a custom JSON file.
This is particularly useful for experimental studies using stable isotope labeling with:</p>
<ul class="simple">
<li><p>Carbon (13C)</p></li>
<li><p>Hydrogen (2H)</p></li>
<li><p>Nitrogen (15N)</p></li>
<li><p>Oxygen (17O, 18O)</p></li>
<li><p>Sulfur (33S, 34S)</p></li>
</ul>
<p>Key points about isotope configuration:</p>
<ul class="simple">
<li><p>Use the <cite>–label</cite> (<cite>-l</cite>) option with a custom JSON file</p></li>
<li><p>Only specify the elements you want to override</p></li>
<li><p>Isotope abundances must sum to 1.0 (MIMI verifies this)</p></li>
<li><p>For multiple labeled elements, include all in one file</p></li>
</ul>
<p>Example: For 95% 13C labeling, you can use the provided configuration file at <a class="reference external" href="https://raw.githubusercontent.com/NYUAD-Core-Bioinformatics/MIMI/refs/heads/main/data/processed/C13_95.json">C13_95.json</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">C13_95</span><span class="o">.</span><span class="n">json</span>
<span class="p">{</span>
  <span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;periodic_number&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
      <span class="s2">&quot;element_symbol&quot;</span><span class="p">:</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span>
      <span class="s2">&quot;nominal_mass&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
      <span class="s2">&quot;exact_mass&quot;</span><span class="p">:</span> <span class="mf">12.000</span><span class="p">,</span>
      <span class="s2">&quot;isotope_abundance&quot;</span><span class="p">:</span> <span class="mf">0.05</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">&quot;periodic_number&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
      <span class="s2">&quot;element_symbol&quot;</span><span class="p">:</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span>
      <span class="s2">&quot;nominal_mass&quot;</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span>
      <span class="s2">&quot;exact_mass&quot;</span><span class="p">:</span> <span class="mf">13.00335484</span><span class="p">,</span>
      <span class="s2">&quot;isotope_abundance&quot;</span><span class="p">:</span> <span class="mf">0.95</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For C13-95% labeled compounds, create a cache with the isotope configuration:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mimi_cache_create</span> <span class="o">-</span><span class="n">i</span> <span class="n">neg</span> <span class="o">-</span><span class="n">l</span> <span class="n">data</span><span class="o">/</span><span class="n">processed</span><span class="o">/</span><span class="n">C13_95</span><span class="o">.</span><span class="n">json</span> <span class="o">-</span><span class="n">d</span> <span class="n">data</span><span class="o">/</span><span class="n">processed</span><span class="o">/</span><span class="n">kegg_compounds_40_1000Da_sorted_uniq</span><span class="o">.</span><span class="n">tsv</span> <span class="o">-</span><span class="n">c</span> <span class="n">outdir</span><span class="o">/</span><span class="n">db_C13_95</span>
</pre></div>
</div>
<p>Expected Output: A cache file with isotope patterns adjusted for C13-95% labeling.</p>
<p>Use this when analyzing labeled samples.</p>
</section>
<section id="verify-cache">
<span id="id8"></span><h2>Verify Cache<a class="headerlink" href="#verify-cache" title="Permalink to this headline"></a></h2>
<p>Before proceeding with analysis, it’s good practice to verify your cache contents. This helps ensure that the compounds and their isotope patterns were processed correctly:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mimi_cache_dump</span> <span class="n">outdir</span><span class="o">/</span><span class="n">db_nat</span><span class="o">.</span><span class="n">pkl</span> <span class="o">-</span><span class="n">n</span> <span class="mi">2</span> <span class="o">-</span><span class="n">i</span> <span class="mi">2</span>
</pre></div>
</div>
<p>Example output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mimi_cache_dump</span> <span class="n">outdir</span><span class="o">/</span><span class="n">db_nat</span><span class="o">.</span><span class="n">pkl</span> <span class="o">-</span><span class="n">n</span> <span class="mi">2</span> <span class="o">-</span><span class="n">i</span> <span class="mi">2</span>
<span class="c1"># Cache Metadata:</span>
<span class="c1"># Creation Date: 2025-04-26T00:08:03</span>
<span class="c1"># MIMI Version: 1.0.0</span>

<span class="c1"># Creation Parameters:</span>
<span class="c1"># Full Command: /Users/aaa/anaconda3/envs/v_test/bin/mimi_cache_create -i neg -d data/processed/kegg_compounds_40_1000Da_sorted_uniq.tsv -c outdir/db_nat</span>
<span class="c1"># Ionization Mode: neg</span>
<span class="c1"># Labeled Atoms File: None</span>
<span class="c1"># Compound DB Files: data/processed/kegg_compounds_40_1000Da_sorted_uniq.tsv</span>
<span class="c1"># Cache Output File: outdir/db_nat.pkl</span>
<span class="c1"># Isotope Data File: mimi/data/natural_isotope_abundance_NIST.json</span>

<span class="o">============================================================</span>
<span class="n">Compound</span> <span class="n">ID</span><span class="p">:</span>      <span class="n">C07350</span>
<span class="n">Name</span><span class="p">:</span>             <span class="n">Phlorisovalerophenone</span>
<span class="n">Formula</span><span class="p">:</span>          <span class="p">[</span><span class="mi">12</span><span class="p">]</span><span class="n">C11</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="n">H14</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span><span class="n">O4</span>
<span class="n">Mono</span><span class="o">-</span><span class="n">isotopic</span><span class="p">:</span>    <span class="n">Yes</span> <span class="p">(</span><span class="n">most</span> <span class="n">abundant</span> <span class="n">isotope</span><span class="p">)</span>
<span class="n">Mass</span><span class="p">:</span>             <span class="mf">209.081932</span>
<span class="n">Relative</span> <span class="n">Abund</span><span class="p">:</span>   <span class="mf">1.000000</span> <span class="p">(</span><span class="n">reference</span><span class="p">)</span>
<span class="o">------------------------------------------------------------</span>
<span class="n">ISOTOPE</span> <span class="n">VARIANTS</span><span class="p">:</span>
<span class="n">Variant</span> <span class="c1">#1:</span>
<span class="n">Formula</span><span class="p">:</span>        <span class="p">[</span><span class="mi">12</span><span class="p">]</span><span class="n">C10</span> <span class="p">[</span><span class="mi">13</span><span class="p">]</span><span class="n">C1</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="n">H14</span> <span class="p">[</span><span class="mi">16</span><span class="p">]</span><span class="n">O4</span>
<span class="n">Mono</span><span class="o">-</span><span class="n">isotopic</span><span class="p">:</span>  <span class="n">No</span> <span class="p">(</span><span class="n">isotope</span> <span class="n">variant</span><span class="p">)</span>
<span class="n">Mass</span><span class="p">:</span>           <span class="mf">210.085287</span>
<span class="n">Relative</span> <span class="n">Abund</span><span class="p">:</span> <span class="mf">0.118973</span> <span class="p">(</span><span class="n">expected</span><span class="p">)</span>
<span class="o">------------------------------------------------------------</span>
<span class="n">Variant</span> <span class="c1">#2:</span>
<span class="n">Formula</span><span class="p">:</span>        <span class="p">[</span><span class="mi">12</span><span class="p">]</span><span class="n">C11</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="n">H14</span> <span class="p">[</span><span class="mi">16</span><span class="p">]</span><span class="n">O3</span> <span class="p">[</span><span class="mi">18</span><span class="p">]</span><span class="n">O1</span>
<span class="n">Mono</span><span class="o">-</span><span class="n">isotopic</span><span class="p">:</span>  <span class="n">No</span> <span class="p">(</span><span class="n">isotope</span> <span class="n">variant</span><span class="p">)</span>
<span class="n">Mass</span><span class="p">:</span>           <span class="mf">211.086177</span>
<span class="n">Relative</span> <span class="n">Abund</span><span class="p">:</span> <span class="mf">0.008220</span> <span class="p">(</span><span class="n">expected</span><span class="p">)</span>
<span class="o">------------------------------------------------------------</span>

<span class="o">============================================================</span>
<span class="n">Compound</span> <span class="n">ID</span><span class="p">:</span>      <span class="n">C08999</span>
<span class="n">Name</span><span class="p">:</span>             <span class="n">Capillarisin</span>
<span class="n">Formula</span><span class="p">:</span>          <span class="p">[</span><span class="mi">12</span><span class="p">]</span><span class="n">C16</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="n">H12</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span><span class="n">O7</span>
<span class="n">Mono</span><span class="o">-</span><span class="n">isotopic</span><span class="p">:</span>    <span class="n">Yes</span> <span class="p">(</span><span class="n">most</span> <span class="n">abundant</span> <span class="n">isotope</span><span class="p">)</span>
<span class="n">Mass</span><span class="p">:</span>             <span class="mf">315.051026</span>
<span class="n">Relative</span> <span class="n">Abund</span><span class="p">:</span>   <span class="mf">1.000000</span> <span class="p">(</span><span class="n">reference</span><span class="p">)</span>
<span class="o">------------------------------------------------------------</span>
<span class="n">ISOTOPE</span> <span class="n">VARIANTS</span><span class="p">:</span>
<span class="n">Variant</span> <span class="c1">#1:</span>
<span class="n">Formula</span><span class="p">:</span>        <span class="p">[</span><span class="mi">12</span><span class="p">]</span><span class="n">C15</span> <span class="p">[</span><span class="mi">13</span><span class="p">]</span><span class="n">C1</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="n">H12</span> <span class="p">[</span><span class="mi">16</span><span class="p">]</span><span class="n">O7</span>
<span class="n">Mono</span><span class="o">-</span><span class="n">isotopic</span><span class="p">:</span>  <span class="n">No</span> <span class="p">(</span><span class="n">isotope</span> <span class="n">variant</span><span class="p">)</span>
<span class="n">Mass</span><span class="p">:</span>           <span class="mf">316.054381</span>
<span class="n">Relative</span> <span class="n">Abund</span><span class="p">:</span> <span class="mf">0.173052</span> <span class="p">(</span><span class="n">expected</span><span class="p">)</span>
<span class="o">------------------------------------------------------------</span>
<span class="n">Variant</span> <span class="c1">#2:</span>
<span class="n">Formula</span><span class="p">:</span>        <span class="p">[</span><span class="mi">12</span><span class="p">]</span><span class="n">C16</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="n">H12</span> <span class="p">[</span><span class="mi">16</span><span class="p">]</span><span class="n">O6</span> <span class="p">[</span><span class="mi">18</span><span class="p">]</span><span class="n">O1</span>
<span class="n">Mono</span><span class="o">-</span><span class="n">isotopic</span><span class="p">:</span>  <span class="n">No</span> <span class="p">(</span><span class="n">isotope</span> <span class="n">variant</span><span class="p">)</span>
<span class="n">Mass</span><span class="p">:</span>           <span class="mf">317.055271</span>
<span class="n">Relative</span> <span class="n">Abund</span><span class="p">:</span> <span class="mf">0.014385</span> <span class="p">(</span><span class="n">expected</span><span class="p">)</span>
<span class="o">------------------------------------------------------------</span>
</pre></div>
</div>
</section>
<section id="step3-sample-analysis">
<span id="id9"></span><h2>Step3: Sample Analysis<a class="headerlink" href="#step3-sample-analysis" title="Permalink to this headline"></a></h2>
</section>
<section id="input-file-format">
<span id="id10"></span><h2>Input File Format<a class="headerlink" href="#input-file-format" title="Permalink to this headline"></a></h2>
<p>MIMI accepts mass spectrometry data in .asc format. Each line contains three columns:</p>
<ul class="simple">
<li><p>Mass (m/z)</p></li>
<li><p>Intensity</p></li>
<li><p>Resolution</p></li>
</ul>
<p>Example input file (data/processed/testdata1.asc):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">43.16184</span>    <span class="mi">1089317</span>    <span class="mf">0.00003</span>
<span class="mf">43.28766</span>    <span class="mi">1115802</span>    <span class="mf">0.00003</span>
<span class="mf">43.28946</span>    <span class="mi">1226947</span>    <span class="mf">0.00003</span>
<span class="mf">43.30269</span>    <span class="mi">1107425</span>    <span class="mf">0.00005</span>
<span class="mf">43.36457</span>    <span class="mi">2236071</span>    <span class="mf">0.00004</span>
<span class="mf">43.36459</span>    <span class="mi">1891040</span>    <span class="mf">0.00004</span>
<span class="mf">43.37268</span>    <span class="mi">1281049</span>    <span class="mf">0.00004</span>
<span class="mf">43.4223</span>     <span class="mi">2184166</span>    <span class="mf">0.00002</span>
<span class="mf">43.42234</span>    <span class="mi">23344476</span>   <span class="mf">0.00004</span>
<span class="mf">43.42237</span>    <span class="mi">22443004</span>   <span class="mf">0.00004</span>
</pre></div>
</div>
<p>Now you’re ready to analyze your mass spectrometry data. The analysis command matches your sample masses against the precomputed database and verifies matches using isotope patterns:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mimi_mass_analysis</span> <span class="o">-</span><span class="n">p</span> <span class="mf">1.0</span> <span class="o">-</span><span class="n">vp</span> <span class="mf">1.0</span> <span class="o">-</span><span class="n">c</span> <span class="n">outdir</span><span class="o">/</span><span class="n">db_nat</span> <span class="n">outdir</span><span class="o">/</span><span class="n">db_C13_95</span> <span class="o">-</span><span class="n">s</span> <span class="n">data</span><span class="o">/</span><span class="n">processed</span><span class="o">/</span><span class="n">testdata1</span><span class="o">.</span><span class="n">asc</span> <span class="o">-</span><span class="n">o</span> <span class="n">outdir</span><span class="o">/</span><span class="n">results</span><span class="o">.</span><span class="n">tsv</span>
</pre></div>
</div>
<p>Key parameters:</p>
<ul class="simple">
<li><p><cite>-p 1.0</cite>: Mass matching tolerance (1 ppm) - controls how close the observed mass needs to be to the theoretical mass</p></li>
<li><p><cite>-vp 1.0</cite>: Isotope pattern verification tolerance (1 ppm) - controls how well the isotope pattern must match</p></li>
<li><p><cite>-c</cite>: Cache files to use (can specify multiple for comparing natural and labeled patterns)</p></li>
<li><p><cite>-s</cite>: Sample file to analyze (in .asc format)</p></li>
<li><p><cite>-o</cite>: Output file for results</p></li>
</ul>
</section>
<section id="ppm-thresholds">
<span id="id11"></span><h2>PPM Thresholds<a class="headerlink" href="#ppm-thresholds" title="Permalink to this headline"></a></h2>
<p>The PPM threshold affects match precision and reliability:</p>
<ul class="simple">
<li><p><strong>&lt;0.5 ppm</strong>: Excellent mass accuracy, high confidence in exact mass identification</p></li>
<li><p><strong>0.5 - 1 ppm</strong>: Good mass accuracy, reliable identification with isotope pattern validation</p></li>
<li><p><strong>1-2 ppm</strong>: Lower mass accuracy, less reliable identifications</p></li>
<li><p><strong>&gt;2 ppm</strong>: Not recommended for high-resolution mass spectrometry data</p></li>
</ul>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># High confidence analysis</span>
<span class="n">mimi_mass_analysis</span> <span class="o">-</span><span class="n">p</span> <span class="mf">0.5</span> <span class="o">-</span><span class="n">vp</span> <span class="mf">0.5</span> <span class="o">-</span><span class="n">c</span> <span class="n">outdir</span><span class="o">/</span><span class="n">db_nat</span> <span class="o">-</span><span class="n">s</span> <span class="n">data</span><span class="o">/</span><span class="n">processed</span><span class="o">/</span><span class="n">testdata1</span><span class="o">.</span><span class="n">asc</span> <span class="o">-</span><span class="n">o</span> <span class="n">outdir</span><span class="o">/</span><span class="n">results_excellent</span><span class="o">.</span><span class="n">tsv</span>

<span class="c1"># Standard confidence analysis</span>
<span class="n">mimi_mass_analysis</span> <span class="o">-</span><span class="n">p</span> <span class="mf">1.0</span> <span class="o">-</span><span class="n">vp</span> <span class="mf">1.0</span> <span class="o">-</span><span class="n">c</span> <span class="n">outdir</span><span class="o">/</span><span class="n">db_nat</span> <span class="o">-</span><span class="n">s</span> <span class="n">data</span><span class="o">/</span><span class="n">processed</span><span class="o">/</span><span class="n">testdata1</span><span class="o">.</span><span class="n">asc</span> <span class="o">-</span><span class="n">o</span> <span class="n">outdir</span><span class="o">/</span><span class="n">results_good</span><span class="o">.</span><span class="n">tsv</span>
</pre></div>
</div>
</section>
<section id="multiple-cache-analysis">
<span id="id12"></span><h2>Multiple Cache Analysis<a class="headerlink" href="#multiple-cache-analysis" title="Permalink to this headline"></a></h2>
<p>You can analyze your samples against multiple caches simultaneously. This is useful when comparing natural and labeled patterns:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mimi_mass_analysis</span> <span class="o">-</span><span class="n">p</span> <span class="mf">1.0</span> <span class="o">-</span><span class="n">vp</span> <span class="mf">1.0</span> <span class="o">-</span><span class="n">c</span> <span class="n">outdir</span><span class="o">/</span><span class="n">db_nat</span> <span class="n">outdir</span><span class="o">/</span><span class="n">db_13C</span> <span class="o">-</span><span class="n">s</span> <span class="n">data</span><span class="o">/</span><span class="n">processed</span><span class="o">/</span><span class="n">testdata1</span><span class="o">.</span><span class="n">asc</span> <span class="o">-</span><span class="n">o</span> <span class="n">outdir</span><span class="o">/</span><span class="n">results</span><span class="o">.</span><span class="n">tsv</span>
</pre></div>
</div>
</section>
<section id="batch-processing">
<span id="id13"></span><h2>Batch Processing<a class="headerlink" href="#batch-processing" title="Permalink to this headline"></a></h2>
<p>MIMI supports processing multiple samples in a single run. This is useful for analyzing replicates or comparing different conditions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mimi_mass_analysis</span> <span class="o">-</span><span class="n">p</span> <span class="mf">1.0</span> <span class="o">-</span><span class="n">vp</span> <span class="mf">1.0</span> <span class="o">-</span><span class="n">c</span> <span class="n">outdir</span><span class="o">/</span><span class="n">db_nat</span> <span class="o">-</span><span class="n">s</span> <span class="n">data</span><span class="o">/</span><span class="n">processed</span><span class="o">/</span><span class="n">testdata1</span><span class="o">.</span><span class="n">asc</span> <span class="n">data</span><span class="o">/</span><span class="n">processed</span><span class="o">/</span><span class="n">testdata2</span><span class="o">.</span><span class="n">asc</span> <span class="o">-</span><span class="n">o</span> <span class="n">outdir</span><span class="o">/</span><span class="n">batch_results</span><span class="o">.</span><span class="n">tsv</span>
</pre></div>
</div>
</section>
<section id="results-format">
<span id="id14"></span><h2>Results Format<a class="headerlink" href="#results-format" title="Permalink to this headline"></a></h2>
<p>The output TSV file contains these columns:</p>
<ul class="simple">
<li><p><strong>CF</strong>: Chemical formula of the matched compound</p></li>
<li><p><strong>ID</strong>: Compound identifier from the original database</p></li>
<li><p><strong>Name</strong>: Compound name</p></li>
<li><p><strong>C</strong>: Number of carbon atoms</p></li>
<li><p><strong>H</strong>: Number of hydrogen atoms</p></li>
<li><p><strong>N</strong>: Number of nitrogen atoms</p></li>
<li><p><strong>O</strong>: Number of oxygen atoms</p></li>
<li><p><strong>P</strong>: Number of phosphorus atoms</p></li>
<li><p><strong>S</strong>: Number of sulfur atoms</p></li>
<li><p><strong>db_mass_nat</strong>: Calculated mass for natural abundance(User specified)</p></li>
<li><p><strong>db_mass_C13</strong>: Calculated mass for C13-labeled (User specified)</p></li>
<li><p><strong>mass_measured</strong>: Observed mass in the sample</p></li>
<li><p><strong>error_ppm</strong>: Parts per million difference between calculated and observed mass</p></li>
<li><p><strong>intensity</strong>: Signal intensity in the sample</p></li>
<li><p><strong>iso_count</strong>: Number of isotopes detected</p></li>
</ul>
<p>Example output file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Log</span> <span class="n">file</span>  <span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">aaa</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">results_20250426_000954</span><span class="o">.</span><span class="n">log</span>
                                                                        <span class="n">data</span><span class="o">/</span><span class="n">processed</span><span class="o">/</span><span class="n">testdata1</span><span class="o">.</span><span class="n">asc</span>
                                                                        <span class="n">db_nat</span>                                            <span class="n">db_C13_95</span>
<span class="n">CF</span>        <span class="n">ID</span>      <span class="n">Name</span>              <span class="n">C</span> <span class="n">H</span> <span class="n">N</span> <span class="n">O</span> <span class="n">P</span> <span class="n">S</span> <span class="n">db_nat_mass</span> <span class="n">db_C13_95_mass</span> <span class="n">mass_measured</span> <span class="n">error_ppm</span>     <span class="n">intensity</span>   <span class="n">iso_count</span> <span class="n">mass_measured</span> <span class="n">error_ppm</span>     <span class="n">intensity</span>     <span class="n">iso_count</span>
<span class="n">C5H5N5</span>    <span class="n">C00147</span>  <span class="n">Adenine</span>           <span class="mi">5</span> <span class="mi">5</span> <span class="mi">5</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mf">134.0472187</span> <span class="mf">139.0639929</span> <span class="mf">134.04722</span>     <span class="o">-</span><span class="mf">0.009576476</span>  <span class="mf">10030305.6</span>  <span class="mi">3</span>         <span class="mf">139.06396</span>     <span class="mf">0.236698942</span>   <span class="mf">143680406.4</span>   <span class="mi">4</span>
<span class="n">C5H9NO2</span>   <span class="n">C00148</span>  <span class="n">L</span><span class="o">-</span><span class="n">Proline</span>         <span class="mi">5</span> <span class="mi">9</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mf">114.0560521</span> <span class="mf">119.0728263</span> <span class="mf">114.05601</span>     <span class="mf">0.368824269</span>   <span class="mf">18852508.02</span> <span class="mi">4</span>         <span class="mf">119.0728</span>      <span class="mf">0.220593068</span>   <span class="mf">72633081.845</span>  <span class="mi">8</span>
<span class="n">C4H6O5</span>    <span class="n">C00149</span>  <span class="p">(</span><span class="n">S</span><span class="p">)</span><span class="o">-</span><span class="n">Malate</span>        <span class="mi">4</span> <span class="mi">6</span> <span class="mi">0</span> <span class="mi">5</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mf">133.0142468</span> <span class="mf">137.0276662</span> <span class="mf">133.01424</span>     <span class="mf">0.051304504</span>   <span class="mf">4229908.65</span>  <span class="mi">2</span>         <span class="mf">137.02769</span>     <span class="o">-</span><span class="mf">0.173802639</span>  <span class="mf">2550057.38</span>    <span class="mi">4</span>
<span class="n">C4H8N2O3</span>  <span class="n">C00152</span>  <span class="n">L</span><span class="o">-</span><span class="n">Asparagine</span>      <span class="mi">4</span> <span class="mi">8</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mf">131.0462157</span> <span class="mf">135.059635</span>  <span class="mf">131.04617</span>     <span class="mf">0.348414563</span>   <span class="mf">4418266.3</span>   <span class="mi">4</span>         <span class="mf">135.0596</span>      <span class="mf">0.259281095</span>   <span class="mf">123609409.5</span>   <span class="mi">8</span>
<span class="n">C6H6N2O</span>   <span class="n">C00153</span>  <span class="n">Nicotinamide</span>      <span class="mi">6</span> <span class="mi">6</span> <span class="mi">2</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mf">121.0407364</span>             <span class="mf">121.04075</span>     <span class="o">-</span><span class="mf">0.112732212</span>  <span class="mf">640304.28</span>   <span class="mi">1</span>
<span class="n">C4H9NO2S</span>  <span class="n">C00155</span>  <span class="n">L</span><span class="o">-</span><span class="n">Homocysteine</span>    <span class="mi">4</span> <span class="mi">9</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mf">134.0281232</span> <span class="mf">138.0415426</span> <span class="mf">134.02816</span>     <span class="o">-</span><span class="mf">0.274263036</span>  <span class="mf">1882881.1</span>   <span class="mi">3</span>         <span class="mf">138.04156</span>     <span class="o">-</span><span class="mf">0.126041477</span>  <span class="mf">554962.24</span>     <span class="mi">7</span>
<span class="n">C7H6O3</span>    <span class="n">C00156</span>  <span class="mi">4</span><span class="o">-</span><span class="n">Hydroxybenzoate</span> <span class="mi">7</span> <span class="mi">6</span> <span class="mi">0</span> <span class="mi">3</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mf">137.0244176</span>             <span class="mf">137.02444</span>     <span class="o">-</span><span class="mf">0.163583326</span>  <span class="mf">87231044.64</span> <span class="mi">2</span>
</pre></div>
</div>
</section>
<section id="comprehensive-analysis-runs">
<span id="id15"></span><h2>Comprehensive Analysis Runs<a class="headerlink" href="#comprehensive-analysis-runs" title="Permalink to this headline"></a></h2>
<p>MIMI provides a comprehensive analysis script that allows you to perform multiple analyses with different parameter combinations in a single run. This is particularly useful for:</p>
<ul class="simple">
<li><p>Testing different mass matching tolerances</p></li>
<li><p>Comparing isotope pattern verification thresholds</p></li>
<li><p>Analyzing multiple samples simultaneously</p></li>
<li><p>Generating results for different parameter combinations</p></li>
</ul>
<p>The comprehensive run script (<cite>run.sh</cite>) performs the following steps:</p>
<ol class="arabic simple">
<li><p><strong>Setup and Validation</strong>:</p>
<ul class="simple">
<li><p>Checks for required input and output directories</p></li>
<li><p>Creates the output directory if it doesn’t exist</p></li>
<li><p>Validates the input parameters</p></li>
</ul>
</li>
<li><p><strong>Cache Creation</strong>:</p>
<ul class="simple">
<li><p>Creates two cache files:</p>
<ul>
<li><p>Natural abundance cache (<cite>db_nat.pkl</cite>)</p></li>
<li><p>C13-95% labeled cache (<cite>db_C13_95.pkl</cite>)</p></li>
</ul>
</li>
<li><p>Uses the test database and C13-95% labeling configuration</p></li>
</ul>
</li>
<li><p><strong>Parameter Testing</strong>:</p>
<ul class="simple">
<li><p>Tests different combinations of parameters:</p>
<ul>
<li><p>Mass matching tolerance (p): 0.1, 0.5, 1.0 ppm</p></li>
<li><p>Isotope pattern verification (vp): 0.1, 0.5, 1.0 ppm</p></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Analysis Types</strong>:</p>
<ul class="simple">
<li><p><strong>Fixed vp Analysis</strong>: Varies mass matching tolerance while keeping isotope verification fixed at 0.5 ppm</p></li>
<li><p><strong>Fixed p Analysis</strong>: Varies isotope verification while keeping mass matching fixed at 0.5 ppm</p></li>
</ul>
</li>
</ol>
<p>Example Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sh</span> <span class="o">./</span><span class="n">run</span><span class="o">.</span><span class="n">sh</span> <span class="n">data</span><span class="o">/</span><span class="n">processed</span> <span class="n">outdir</span>
</pre></div>
</div>
<p>The script content:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/bin/bash

# Check if both output and data directories are provided as arguments
if [ $# -ne 2 ]; then
    echo &quot;Usage: $0 &lt;data_directory&gt; &lt;output_directory&gt;&quot;
    exit 1
fi

# Get directories from command line arguments
datadir=&quot;$1&quot;
outdir=&quot;$2&quot;

# Create output directory
mkdir -p &quot;$outdir&quot;

# Sort and remove duplicates from KEGG compounds file
cp &quot;$datadir/kegg_compounds_40_1000Da.tsv&quot; &quot;$outdir/testDB.tsv&quot;
{ head -n 1 &quot;$outdir/testDB.tsv&quot;; tail -n +2 &quot;$outdir/testDB.tsv&quot; | sort -k2,2; } &gt; &quot;$outdir/testDB_sorted.tsv&quot;
awk &#39;!seen[$1]++&#39; &quot;$outdir/testDB_sorted.tsv&quot; &gt; &quot;$outdir/testDB_sorted_uniq.tsv&quot;



# Create cache files in outdir and check for success
mimi_cache_create  -i neg   -d &quot;$outdir/testDB_sorted_uniq.tsv&quot;  -c &quot;$outdir/db_nat&quot;
mimi_cache_create  -i neg   -l &quot;$datadir/C13_95.json&quot; -d &quot;$outdir/testDB_sorted_uniq.tsv&quot;  -c &quot;$outdir/db_C13_95&quot;


if [ ! -f &quot;$outdir/db_nat.pkl&quot; ] || [ ! -f &quot;$outdir/db_C13_95.pkl&quot; ]; then
    echo &quot;Error: Failed to create cache files&quot;
    exit 1
fi

# Define test data files
test_files=(&quot;testdata1.asc&quot; &quot;testdata2.asc&quot;)

# Define parameter sets
p_values=(0.1 0.5 1)
vp_values=(0.1 0.5 1)

# Loop through each test file
for test_file in &quot;${test_files[@]}&quot;; do
    base_name=$(basename &quot;$test_file&quot; .asc)

    # Analysis for top graph (fixed vp=0.5, varying p)
    for p in &quot;${p_values[@]}&quot;; do
        p_str=$(echo $p | tr -d &#39;.&#39;)
        mimi_mass_analysis -p $p -vp 0.5 -c &quot;$outdir/db_nat&quot; &quot;$outdir/db_C13_95&quot; -s &quot;$datadir/$test_file&quot; -o &quot;$outdir/n${base_name}_p${p_str}_vp05_combined.tsv&quot;
    done

    # Analysis for bottom graph (fixed p=0.5, varying vp)
    for vp in &quot;${vp_values[@]}&quot;; do
        # Format vp value without underscore, just remove the dot
        vp_str=$(echo $vp | tr -d &#39;.&#39;)
        mimi_mass_analysis -p 0.5 -vp $vp -c &quot;$outdir/db_nat&quot; &quot;$outdir/db_C13_95&quot; -s &quot;$datadir/$test_file&quot; -o &quot;$outdir/n${base_name}_p05_vp${vp_str}_combined.tsv&quot;
    done
done


echo &quot;Processing complete.&quot;
</pre></div>
</div>
<p>Example output files for testdata1.asc:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ntestdata1_p01_vp05_combined</span><span class="o">.</span><span class="n">tsv</span>    <span class="c1"># p=0.1, vp=0.5</span>
<span class="n">ntestdata1_p05_vp05_combined</span><span class="o">.</span><span class="n">tsv</span>    <span class="c1"># p=0.5, vp=0.5</span>
<span class="n">ntestdata1_p1_vp05_combined</span><span class="o">.</span><span class="n">tsv</span>     <span class="c1"># p=1.0, vp=0.5</span>
<span class="n">ntestdata1_p05_vp01_combined</span><span class="o">.</span><span class="n">tsv</span>    <span class="c1"># p=0.5, vp=0.1</span>
<span class="n">ntestdata1_p05_vp05_combined</span><span class="o">.</span><span class="n">tsv</span>    <span class="c1"># p=0.5, vp=0.5</span>
<span class="n">ntestdata1_p05_vp1_combined</span><span class="o">.</span><span class="n">tsv</span>     <span class="c1"># p=0.5, vp=1.0</span>
</pre></div>
</div>
<p>This comprehensive analysis approach helps you:</p>
<ul class="simple">
<li><p>Find optimal parameter combinations for your data</p></li>
<li><p>Compare results across different parameter settings</p></li>
<li><p>Generate multiple result sets for further analysis</p></li>
<li><p>Validate the robustness of your compound identifications</p></li>
</ul>
</section>
<section id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline"></a></h2>
<ol class="arabic simple">
<li><p><strong>Data Quality</strong>:</p>
<ul class="simple">
<li><p>Always combine mass accuracy with isotope pattern matching</p></li>
<li><p>Compare results from natural and labeled caches</p></li>
<li><p>Process replicates together for consistency</p></li>
<li><p>Verify important matches manually</p></li>
</ul>
</li>
<li><p><strong>Common Issues and Solutions</strong>:</p>
<ul class="simple">
<li><p><strong>No matches found</strong>:</p>
<ul>
<li><p>Increase PPM threshold</p></li>
<li><p>Verify sample format</p></li>
<li><p>Check ionization mode</p></li>
</ul>
</li>
<li><p><strong>Too many matches</strong>:</p>
<ul>
<li><p>Decrease PPM threshold</p></li>
<li><p>Use stricter verification PPM</p></li>
<li><p>Filter by isotope score</p></li>
</ul>
</li>
<li><p><strong>Cache creation errors</strong>:</p>
<ul>
<li><p>Verify chemical formulas</p></li>
<li><p>Check labeling configuration</p></li>
<li><p>Enable debugging</p></li>
</ul>
</li>
<li><p><strong>Performance issues</strong>:</p>
<ul>
<li><p>Use focused databases</p></li>
<li><p>Process samples in smaller batches</p></li>
<li><p>Optimize mass ranges</p></li>
</ul>
</li>
</ul>
</li>
</ol>
</section>
<section id="complete-example">
<h2>Complete Example<a class="headerlink" href="#complete-example" title="Permalink to this headline"></a></h2>
<p>Here’s a complete example from start to finish:</p>
<ol class="arabic">
<li><p>First, extract compounds from KEGG within your desired mass range:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mimi_kegg_extract</span> <span class="o">-</span><span class="n">l</span> <span class="mi">40</span> <span class="o">-</span><span class="n">u</span> <span class="mi">1000</span> <span class="o">-</span><span class="n">o</span> <span class="n">data</span><span class="o">/</span><span class="n">processed</span><span class="o">/</span><span class="n">kegg_compounds_40_1000Da</span><span class="o">.</span><span class="n">tsv</span>

<span class="c1"># Sort and remove duplicates from KEGG compounds file</span>
<span class="p">{</span> <span class="n">head</span> <span class="o">-</span><span class="n">n</span> <span class="mi">1</span> <span class="n">data</span><span class="o">/</span><span class="n">processed</span><span class="o">/</span><span class="n">kegg_compounds_40_1000Da</span><span class="o">.</span><span class="n">tsv</span><span class="p">;</span> <span class="n">tail</span> <span class="o">-</span><span class="n">n</span> <span class="o">+</span><span class="mi">2</span> <span class="n">data</span><span class="o">/</span><span class="n">processed</span><span class="o">/</span><span class="n">kegg_compounds_40_1000Da</span><span class="o">.</span><span class="n">tsv</span> <span class="o">|</span> <span class="n">sort</span> <span class="o">-</span><span class="n">k2</span><span class="p">,</span><span class="mi">2</span><span class="p">;</span> <span class="p">}</span> <span class="o">&gt;</span> <span class="n">data</span><span class="o">/</span><span class="n">processed</span><span class="o">/</span><span class="n">kegg_compounds_40_1000Da_sorted</span><span class="o">.</span><span class="n">tsv</span>
<span class="n">awk</span> <span class="s1">&#39;!seen[$1]++&#39;</span> <span class="n">data</span><span class="o">/</span><span class="n">processed</span><span class="o">/</span><span class="n">kegg_compounds_40_1000Da_sorted</span><span class="o">.</span><span class="n">tsv</span> <span class="o">&gt;</span> <span class="n">data</span><span class="o">/</span><span class="n">processed</span><span class="o">/</span><span class="n">kegg_compounds_40_1000Da_sorted_uniq</span><span class="o">.</span><span class="n">tsv</span>
</pre></div>
</div>
</li>
<li><p>Create both natural abundance and C13-95% labeled caches:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Natural abundance</span>
<span class="n">mimi_cache_create</span> <span class="o">-</span><span class="n">i</span> <span class="n">neg</span> <span class="o">-</span><span class="n">d</span> <span class="n">data</span><span class="o">/</span><span class="n">processed</span><span class="o">/</span><span class="n">kegg_compounds_40_1000Da_sorted_uniq</span><span class="o">.</span><span class="n">tsv</span> <span class="o">-</span><span class="n">c</span> <span class="n">outdir</span><span class="o">/</span><span class="n">db_nat</span>

<span class="c1"># C13-95% labeled</span>
<span class="n">mimi_cache_create</span> <span class="o">-</span><span class="n">i</span> <span class="n">neg</span> <span class="o">-</span><span class="n">l</span> <span class="n">data</span><span class="o">/</span><span class="n">processed</span><span class="o">/</span><span class="n">C13_95</span><span class="o">.</span><span class="n">json</span> <span class="o">-</span><span class="n">d</span> <span class="n">data</span><span class="o">/</span><span class="n">processed</span><span class="o">/</span><span class="n">kegg_compounds_40_1000Da_sorted_uniq</span><span class="o">.</span><span class="n">tsv</span> <span class="o">-</span><span class="n">c</span> <span class="n">outdir</span><span class="o">/</span><span class="n">db_C13_95</span>
</pre></div>
</div>
</li>
<li><p>Verify the cache contents to ensure everything was processed correctly:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mimi_cache_dump</span> <span class="n">outdir</span><span class="o">/</span><span class="n">db_nat</span><span class="o">.</span><span class="n">pkl</span> <span class="o">-</span><span class="n">n</span> <span class="mi">2</span> <span class="o">-</span><span class="n">i</span> <span class="mi">2</span>
</pre></div>
</div>
</li>
<li><p>Finally, analyze your sample using both caches:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mimi_mass_analysis</span> <span class="o">-</span><span class="n">p</span> <span class="mf">1.0</span> <span class="o">-</span><span class="n">vp</span> <span class="mf">1.0</span> <span class="o">-</span><span class="n">c</span> <span class="n">outdir</span><span class="o">/</span><span class="n">db_nat</span> <span class="n">outdir</span><span class="o">/</span><span class="n">db_C13_95</span> <span class="o">-</span><span class="n">s</span> <span class="n">data</span><span class="o">/</span><span class="n">processed</span><span class="o">/</span><span class="n">testdata1</span><span class="o">.</span><span class="n">asc</span> <span class="o">-</span><span class="n">o</span> <span class="n">outdir</span><span class="o">/</span><span class="n">results</span><span class="o">.</span><span class="n">tsv</span>
</pre></div>
</div>
</li>
</ol>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="overview.html" class="btn btn-neutral float-left" title="Overview" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="architecture.html" class="btn btn-neutral float-right" title="Architecture Design" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Nabil Rahiman.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>